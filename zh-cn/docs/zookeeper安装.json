{
  "filename": "zookeeper安装.md",
  "__html": "<h3 id=\"zookeeper\">zookeeper <a class=\"header-anchor\" href=\"#zookeeper\">#</a></h3>\n<h4 id=\"%E4%B8%8B%E8%BD%BD\">下载 <a class=\"header-anchor\" href=\"#%E4%B8%8B%E8%BD%BD\">#</a></h4>\n<pre><code class=\"language-bash\"><span class=\"hljs-comment\">#下载</span>\nwget https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/stable/apache-zookeeper-3.5.9-bin.tar.gz\nmkdir -p /opt/apache\ntar xzvf apache-zookeeper-3.5.9-bin.tar.gz\n<span class=\"hljs-built_in\">cd</span> /opt/apache/apache-zookeeper-3.5.9-bin\nmkdir data\n</code></pre>\n<h4 id=\"%E9%85%8D%E7%BD%AE\">配置 <a class=\"header-anchor\" href=\"#%E9%85%8D%E7%BD%AE\">#</a></h4>\n<pre><code class=\"language-bash\"><span class=\"hljs-comment\">#修改配置</span>\n<span class=\"hljs-built_in\">cd</span> apache-zookeeper-3.5.9\n<span class=\"hljs-built_in\">cd</span> conf/\ncp zoo_sample.cfg  zoo.cfg\nvim zoo.cfg\n\n<span class=\"hljs-comment\">#按照 server.id = ip:port:port    ，在zoo.cfg 文件结尾添加配置</span>\nserver.1=172.19.87.174:2888:3888\nserver.2=172.19.87.173:2888:3888\nserver.3=172.19.87.175:2888:3888\n</code></pre>\n<pre><code class=\"language-bash\"><span class=\"hljs-comment\">#配置完成的zoo.cfg文件为</span>\n\n<span class=\"hljs-comment\"># The number of milliseconds of each tick</span>\ntickTime=2000\n<span class=\"hljs-comment\"># The number of ticks that the initial </span>\n<span class=\"hljs-comment\"># synchronization phase can take</span>\ninitLimit=10\n<span class=\"hljs-comment\"># The number of ticks that can pass between </span>\n<span class=\"hljs-comment\"># sending a request and getting an acknowledgement</span>\nsyncLimit=5\n<span class=\"hljs-comment\"># the directory where the snapshot is stored.</span>\n<span class=\"hljs-comment\"># do not use /tmp for storage, /tmp here is just </span>\n<span class=\"hljs-comment\"># example sakes.</span>\ndataDir=/opt/apache/apache-zookeeper-3.5.9-bin/data\n<span class=\"hljs-comment\"># the port at which the clients will connect</span>\nclientPort=2181\n<span class=\"hljs-comment\"># the maximum number of client connections.</span>\n<span class=\"hljs-comment\"># increase this if you need to handle more clients</span>\n<span class=\"hljs-comment\">#maxClientCnxns=60</span>\n<span class=\"hljs-comment\">#</span>\n<span class=\"hljs-comment\"># Be sure to read the maintenance section of the </span>\n<span class=\"hljs-comment\"># administrator guide before turning on autopurge.</span>\n<span class=\"hljs-comment\">#</span>\n<span class=\"hljs-comment\"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span>\n<span class=\"hljs-comment\">#</span>\n<span class=\"hljs-comment\"># The number of snapshots to retain in dataDir</span>\n<span class=\"hljs-comment\">#autopurge.snapRetainCount=3</span>\n<span class=\"hljs-comment\"># Purge task interval in hours</span>\n<span class=\"hljs-comment\"># Set to \"0\" to disable auto purge feature</span>\n<span class=\"hljs-comment\">#autopurge.purgeInterval=1</span>\n \nserver.1=172.19.87.174:2888:3888\nserver.2=172.19.87.173:2888:3888\nserver.3=172.19.87.175:2888:3888\n</code></pre>\n<p>将该配置文件复制到其他两台机器对应目录下，内容保持不变。</p>\n<p>**注意：**<strong>dataDir=</strong>  参数 配置的目录应该为空目录，不能复用有数据的目录，否则会导致zookeeper启动失败。</p>\n<h4 id=\"%E9%85%8D%E7%BD%AEmyid\">配置myid <a class=\"header-anchor\" href=\"#%E9%85%8D%E7%BD%AEmyid\">#</a></h4>\n<p>根据 server.<strong>id</strong> = <strong>ip</strong>:port:port 中， id 和 ip 的对应关系，分别在 三台节点机器的 dataDir=/var/lib/zookeeper/ 指定的目录下， 新建 myid 文件并且填入对应的数字。</p>\n<pre><code class=\"language-bash\">vim  /var/lib/zookeeper/myid\n<span class=\"hljs-comment\"># 节点1 （ ip 为192.168.111.129 ）</span>\n1\n\n<span class=\"hljs-comment\"># 节点2： （ip 为192.168.111.130 ）</span>\n2\n\n<span class=\"hljs-comment\">#节点3： （ip 为192.168.111.131）</span>\n3\n</code></pre>\n<p>**注意：**myid 文件只能填数字（具体要求如下引用），除此之外不能添加其他内容，空格也不能有，否则会报错。</p>\n<blockquote>\n<p>The myid file consists of a single line containing only the text of that machine's id. So <em>myid</em> of server 1 would contain the text &quot;1&quot; and nothing else. The id must be unique within the ensemble and should have a value between 1 and 255. <strong>IMPORTANT:</strong> if you enable extended features such as TTL Nodes (see below) the id must be between 1 and 254 due to internal limitations.</p>\n</blockquote>\n<h3 id=\"%E6%B5%8B%E8%AF%95\">测试 <a class=\"header-anchor\" href=\"#%E6%B5%8B%E8%AF%95\">#</a></h3>\n<p>（1）关闭防火墙</p>\n<p>首先必须关闭每台机器的防火墙，否则会导致zookeeper启动失败。</p>\n<pre><code class=\"language-bash\">systemctl stop firewalld\n</code></pre>\n<p>（2）启动服务</p>\n<pre><code class=\"language-bash\"><span class=\"hljs-comment\"># 在第一台机器启动zookeeper 服务</span>\n<span class=\"hljs-built_in\">cd</span> apache-zookeeper-3.5.9-bin/\n./bin/zkServer.sh start\n\n<span class=\"hljs-comment\"># 查看启动状态</span>\n./bin/zkServer.sh status\n\n<span class=\"hljs-comment\"># 查看日志</span>\ntail -f ./logs/zookeeper-root-server-node1.out\n\n</code></pre>\n<p>（3）查看程序状态</p>\n<pre><code class=\"language-bash\"><span class=\"hljs-comment\"># 节点1</span>\n./bin/zkServer.sh status\n\n<span class=\"hljs-comment\"># 节点2</span>\n./bin/zkServer.sh status\n\n<span class=\"hljs-comment\"># 节点3</span>\n./bin/zkServer.sh status\n</code></pre>\n<p>（4）测试</p>\n<pre><code class=\"language-bash\">bin/zkCli.sh -server 192.168.111.129:2181,192.168.111.130:2181,192.168.111.131:2181\n</code></pre>\n<h5 id=\"%E5%8F%82%E8%80%83\">参考 <a class=\"header-anchor\" href=\"#%E5%8F%82%E8%80%83\">#</a></h5>\n<p><a href=\"https://blog.csdn.net/abcdu1/article/details/113591746\">https://blog.csdn.net/abcdu1/article/details/113591746</a></p>\n",
  "link": "\\zh-cn\\docs\\zookeeper安装.html",
  "meta": {}
}